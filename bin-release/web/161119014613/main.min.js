var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var fighter;!function(e){var t=function(t){function i(e,i,n){t.call(this),this.blood=10,this.fireDelay=i,this.bmp=new egret.Bitmap(e),this.textureName=n,this.addChild(this.bmp),this.fireTimer=new egret.Timer(i),this.fireTimer.addEventListener(egret.TimerEvent.TIMER,this.createBullet,this)}__extends(i,t);var n=(__define,i),s=n.prototype;return s.fire=function(){this.fireTimer.start()},s.stopFire=function(){this.fireTimer.stop()},s.createBullet=function(e){this.dispatchEventWith("createBullet")},i.produce=function(t,i){null==e.Airplane.cacheDict[t]&&(e.Airplane.cacheDict[t]=[]);var n,s=e.Airplane.cacheDict[t];return n=s.length>0?s.pop():new e.Airplane(RES.getRes(t),i,t),n.blood=10,n},i.reclaim=function(t){var i=t.textureName;null==e.Airplane.cacheDict[i]&&(e.Airplane.cacheDict[i]=[]);var n=e.Airplane.cacheDict[i];-1==n.indexOf(t)&&n.push(t)},i.cacheDict={},i}(egret.DisplayObjectContainer);e.Airplane=t,egret.registerClass(t,"fighter.Airplane")}(fighter||(fighter={}));var fighter;!function(e){var t=function(t){function i(){t.call(this),this.speed=2,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,t);var n=(__define,i),s=n.prototype;return s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var i=RES.getRes("wall_jpg");this.textureWidth=i.textureWidth,this.rowCount=Math.ceil(this.stageW/this.textureWidth)+1,this.bmpArr=[];for(var n=0;n<this.rowCount;n++){var s=e.createBitmapByName("wall_jpg");s.x=this.textureWidth*n-(this.textureWidth*this.rowCount-this.stageW),this.bmpArr.push(s),this.addChild(s)}},s.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},s.enterFrameHandler=function(e){for(var t=0;t<this.rowCount;t++){var i=this.bmpArr[t];i.x+=this.speed,i.x>this.stageW&&(i.x=this.bmpArr[0].x-this.textureWidth,this.bmpArr.pop(),this.bmpArr.unshift(i))}},s.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i}(egret.DisplayObjectContainer);e.BgMap=t,egret.registerClass(t,"fighter.BgMap")}(fighter||(fighter={}));var fighter;!function(e){var t=function(t){function i(e){t.call(this,e)}__extends(i,t);var n=(__define,i);n.prototype;return i.produce=function(t){null==e.Bullet.cacheDict[t]&&(e.Bullet.cacheDict[t]=[]);var i,n=e.Bullet.cacheDict[t];return i=n.length>0?n.pop():new e.Bullet(RES.getRes(t)),i.textureName=t,i},i.reclaim=function(t,i){null==e.Bullet.cacheDict[i]&&(e.Bullet.cacheDict[i]=[]);var n=e.Bullet.cacheDict[i];-1==n.indexOf(t)&&n.push(t)},i.cacheDict={},i}(egret.Bitmap);e.Bullet=t,egret.registerClass(t,"fighter.Bullet")}(fighter||(fighter={}));var fighter;!function(e){var t=function(t){function i(){t.call(this),this.myBullets=[],this.enemyFighters=[],this.enemyFightersTimer=new egret.Timer(1e3),this.enemyBullets=[],this.myScore=0,this._touchStatus=!1,this._distance=new egret.Point,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,t);var n=(__define,i),s=n.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.creatGameScene()},s.creatGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.bg=new e.BgMap,this.gameStart(),this.addChild(this.bg),this.myFighter=new e.Airplane(RES.getRes("plane_png"),100,"plane_png"),this.myFighter.x=this.stageW-this.myFighter.width-600,this.myFighter.y=this.stageH-this.myFighter.height-100,this.myFighter.fire(),this.myFighter.addEventListener(egret.Event.ADDED_TO_STAGE,this.touchHandler,this),this.addChild(this.myFighter),this.btnReturn=new egret.TextField,this.btnReturn.text="返回游戏",this.btnReturn.x=20,this.btnReturn.y=15,this.btnReturn.touchEnabled=!0,this.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),console.log("退出小游戏"),this.parent.addChild(SceneBegin.Shared()),this.parent.removeChild(this)},this),this.addChild(this.btnReturn),this.scorePanel=new e.ScorePanel},s.gameStart=function(){this.bg.start(),this.enemyFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.start(),this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this)},s.createEnemyFighter=function(t){var i=e.Airplane.produce("enemyplane_png",1e3);i.x=Math.random()*(this.stageW-i.width),i.y=this.stageH-i.height-460,i.fire(),this.addChildAt(i,this.numChildren-1),this.enemyFighters.push(i),this.myFighter.addEventListener("createBullet",this.createBulletHandler,this),i.addEventListener("createBullet",this.createBulletHandler,this)},s.createBulletHandler=function(t){var i;if(t.target==this.myFighter)for(var n=0;2>n;n++)i=e.Bullet.produce("b2_png"),i.x=this.myFighter.x+28,i.y=this.myFighter.y+30,this.addChildAt(i,this.numChildren-1-this.enemyBullets.length),this.myBullets.push(i);else{var s=t.target;i=e.Bullet.produce("b3_png"),i.x=s.x+20,i.y=s.y+80,this.addChildAt(i,this.numChildren-1-this.enemyBullets.length),this.enemyBullets.push(i)}},s.gameViewUpdate=function(t){var i=egret.getTimer(),n=1e3/(i-this._lastTime);this._lastTime=i;for(var s,r=60/n,a=0,h=this.myBullets.length;h>a;a++)s=this.myBullets[a],s.y<-s.height&&(this.removeChild(s),e.Bullet.reclaim(s,"b2_bng"),this.myBullets.splice(a,1),a--,h--),s.y-=12*r;var o,l=this.enemyFighters.length;for(a=0;l>a;a++)o=this.enemyFighters[a],this.stage.stageWidth&&o.x>this.stage.stageWidth&&(this.removeChild(o),e.Airplane.reclaim(o),o.removeEventListener("createBullet",this.createBulletHandler,this),o.stopFire(),this.enemyFighters.splice(a,1),a--,l--),o.x+=4*r;var d=this.enemyBullets.length;for(a=0;d>a;a++)s=this.enemyBullets[a],s.y>this.stage.stageHeight&&(this.removeChild(s),e.Bullet.reclaim(s,"b3_bng"),this.enemyBullets.splice(a,1),a--,d--),s.y+=8*r;this.gameHitTest()},s.touchHandler=function(e){e.target==this.myFighter,e.target.touchEnabled=!0,e.target.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),e.target.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this)},s.mouseDown=function(e){this._touchStatus=!0,this._distance.x=e.stageX-this.myFighter.x,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},s.mouseMove=function(e){this._touchStatus&&(this.myFighter.x=e.stageX-this._distance.x)},s.mouseUp=function(e){this._touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},s.gameHitTest=function(){var t,i,n,s,r=this.myBullets.length,a=this.enemyFighters.length,h=this.enemyBullets.length,o=[],l=[];for(t=0;r>t;t++)for(n=this.myBullets[t],i=0;a>i;i++)s=this.enemyFighters[i],e.GameUtil.hitTest(s,n)&&(s.blood-=2,-1==o.indexOf(n)&&o.push(n),s.blood<=0&&-1==l.indexOf(s)&&l.push(s));for(t=0;h>t;t++)n=this.enemyBullets[t],e.GameUtil.hitTest(this.myFighter,n)&&(this.myFighter.blood-=2,-1==o.indexOf(n)&&o.push(n));if(this.myFighter.blood<=0)this.gameStop();else{for(;o.length>0;)n=o.pop(),this.removeChild(n),"b2_png"==n.textureName?this.myBullets.splice(this.myBullets.indexOf(n),1):this.enemyBullets.splice(this.enemyBullets.indexOf(n),1),e.Bullet.reclaim(n,n.textureName);for(this.myScore+=l.length;l.length>0;)s=l.pop(),s.stopFire(),s.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(s),this.enemyFighters.splice(this.enemyFighters.indexOf(s),1),e.Airplane.reclaim(s)}},s.gameStop=function(){this.bg.pause(),this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.myFighter.stopFire(),this.myFighter.removeEventListener("createBullet",this.createBulletHandler,this),this.enemyFightersTimer.removeEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.stop();for(var t;this.myBullets.length>0;)t=this.myBullets.pop(),this.removeChild(t),e.Bullet.reclaim(t,t.textureName);for(;this.enemyBullets.length>0;)t=this.enemyBullets.pop(),this.removeChild(t),e.Bullet.reclaim(t,t.textureName);for(var i;this.enemyFighters.length>0;)i=this.enemyFighters.pop(),i.stopFire(),i.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(i),e.Airplane.reclaim(i);this.scorePanel.showScore(this.myScore),this.scorePanel.x=(this.stageW-this.scorePanel.width)/2,this.scorePanel.y=100,this.addChild(this.scorePanel)},i}(egret.DisplayObjectContainer);e.GameContainer=t,egret.registerClass(t,"fighter.GameContainer")}(fighter||(fighter={}));var fighter;!function(e){function t(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t}var i=function(){function e(){}var t=(__define,e);t.prototype;return e.hitTest=function(e,t){var i=e.getBounds(),n=t.getBounds();return i.x=e.x,i.y=e.y,n.x=t.x,n.y=t.y,i.intersects(n)},e}();e.GameUtil=i,egret.registerClass(i,"fighter.GameUtil"),e.createBitmapByName=t}(fighter||(fighter={}));var fighter;!function(e){var t=function(e){function t(){e.call(this);var t=this.graphics;t.beginFill(0,.8),t.drawRect(0,0,400,200),t.endFill(),this.txt=new egret.TextField,this.txt.width=400,this.txt.height=200,this.txt.textAlign="center",this.txt.textColor=16777215,this.txt.size=24,this.txt.y=60,this.addChild(this.txt)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.showScore=function(e){var t="您击败了"+e+"个敌军\n\n请继续前进吧！";this.txt.text=t},t}(egret.Sprite);e.ScorePanel=t,egret.registerClass(t,"fighter.ScorePanel")}(fighter||(fighter={}));var annex=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(console.log("创建annex对象"),t.shared=new t),t.shared},n.addTexture=function(e){var t=RES.getRes(e+"_png"),i=RES.getRes(e+"_json");this.system=new particle.GravityParticleSystem(t,i),this.system.start(),this.addChild(this.system)},n.removeTexturn=function(){this.removeChild(this.system)},t}(eui.Component);egret.registerClass(annex,"annex");var Aside=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.setAside=function(e){this.asidetext.text=e},t}(eui.Component);egret.registerClass(Aside,"Aside");var AtrributeManager=function(e){function t(){e.call(this),this.Num=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],this.skinName="resource/eui_skins/Attribute.exml",this.force=0,this.wit=0,this.popularity=0,this.qing=0,this.si=0,this.liu=0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clear,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Share=function(){return null==t.shared&&(t.shared=new t),t.shared},n.clear=function(){this.parent.removeChild(this)},n.getFoece=function(){return this.force},n.getWit=function(){return this.wit},n.getPopularity=function(){return this.popularity},n.getQing=function(){return this.qing},n.getSi=function(){return this.si},n.getLiu=function(){return this.liu},n.setAtrribute=function(e){var t=this.force+"-"+this.wit+"-"+this.popularity+"-"+this.qing+"-"+this.si+"-"+this.liu;console.log(t),egret.localStorage.setItem("myAtrribute"+e,t)},n.getAtrribute=function(e){var t=[];t=egret.localStorage.getItem("myAtrribute"+e).split("-"),this.force=parseInt(t[0]),this.wit=parseInt(t[1]),this.popularity=parseInt(t[2]),this.qing=parseInt(t[3]),this.si=parseInt(t[4]),this.liu=parseInt(t[5])},n.addAtrr=function(e,t){switch(e=parseInt(e),t=parseInt(t),e){case 1:this.force+=t;break;case 2:this.wit+=t;break;case 3:this.popularity+=t;break;case 4:this.qing+=t;break;case 5:this.si+=t;break;case 6:this.liu+=t}this.toString()},n.toString=function(){this.force+"-"+this.wit+"-"+this.popularity+"-"+this.qing+"-"+this.si+"-"+this.liu},n.redrawLabel=function(){this.qingLabel.text=this.convertNum(this.qing.toString()),this.siLabel.text=this.convertNum(this.si.toString()),this.liuLabel.text=this.convertNum(this.liu.toString()),this.witLabel.text=this.convertNum(this.wit.toString()),this.popLabel.text=this.convertNum(this.popularity.toString()),this.forceLabel.text=this.convertNum(this.force.toString())},n.convertNum=function(e){for(var t="",i=0;i<e.length;i++)t+=this.Num[parseInt(e.charAt(i))];return t},t}(eui.Component);egret.registerClass(AtrributeManager,"AtrributeManager");var Cartoon=function(e){function t(){e.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,function(){this.skip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.forSkip,this)},this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.forSkip=function(){this.skip.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.forSkip,this),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},n.mouseDown=function(e){this.currenty=e.stageY},n.mouseUp=function(e){this.distanceY=e.stageY-this.currenty,this.forNext()},n.forNext=function(){if(this.current.y>-8320){if(this.distanceY<0){var e=egret.Tween.get(this.current);e.to({y:this.current.y-640},1e3,egret.Ease.sineInOut),this.current.y=this.current.y-640}else if(this.distanceY>0){var e=egret.Tween.get(this.current);e.to({y:this.current.y+640},1e3,egret.Ease.sineInOut),this.current.y=this.current.y+640}}else console.log("结束了！"),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(Cartoon,"Cartoon",["eui.UIComponent"]);var Dialog=function(e){function t(){e.call(this),this.offselection=!0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setNameText=function(e){this.dialogbox.visible=!0,this.person.text=e},n.getNameText=function(){return this.person.text},n.setDialogText=function(e){this.dialog.text=e},n.getDialogText=function(){return this.dialog.text},n.setSelection=function(e){this.offselection=!1,this.dialogbox.visible=!1,this.dialogdata=e;var t=this.dialogdata.select.length;t>0&&(this.select1.visible=!0,this.selection1.text=this.dialogdata.select[0],this.selection1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.s1,this),t>1&&(this.select2.visible=!0,this.selection2.text=this.dialogdata.select[1],this.selection2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.s2,this),t>2&&(this.select3.visible=!0,this.selection3.text=this.dialogdata.select[2],this.selection3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.s3,this))))},n.selected=function(e,t,i,n){this.offselection=!0;var s=[];this.disselect(),this.setNameText(e),this.setDialogText(t),s=i.split("-"),s[0]>0&&AtrributeManager.Share().addAtrr(s[0],s[1]),void 0!=n&&SceneBlock.Shared().setIndex(n)},n.s1=function(){this.selected(this.dialogdata.name,this.dialogdata.content[0],this.dialogdata.add[0],0)},n.s2=function(){this.selected(this.dialogdata.name,this.dialogdata.content[1],this.dialogdata.add[1],1)},n.s3=function(){this.selected(this.dialogdata.name,this.dialogdata.content[2],this.dialogdata.add[2],2)},n.disselect=function(){this.selection1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.s1,this),this.selection2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.s2,this),this.selection3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.s3,this),this.select3.visible=!1,this.select1.visible=!1,this.select2.visible=!1},n.init=function(){this.offselection=!0},t}(eui.Component);egret.registerClass(Dialog,"Dialog");var DialogueData=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(DialogueData,"DialogueData");var DialogManager=function(){function e(){this.items=[],this.items=RES.getRes("dialogue_json")}var t=(__define,e),i=t.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},i.getDialogue=function(e){switch(0>e&&(e=0),e){case 74:SceneBlock.Shared().info.visible=!0;break;case 166:SceneBlock.Shared().info.visible=!0;break;case 295:SceneBlock.Shared().info.visible=!0}return e>73&&Letters.Shared().receiveLetter("mo1"),e>165&&Letters.Shared().receiveLetter("si1"),e>294&&Letters.Shared().receiveLetter("liu1"),this.items[e]},e}();egret.registerClass(DialogManager,"DialogManager");var Ending=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(Ending,"Ending");var EndManage=function(){function e(){this.items=[],this.items=RES.getRes("ending_json")}var t=(__define,e),i=t.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},i.getEnding=function(e){return this.items[e]},e}();egret.registerClass(EndManage,"EndManage");var GameFile=function(e){function t(){e.call(this),this.num=t.index,t.index++,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.saveFile,this);var i=egret.localStorage.getItem("dialogNum"+this.num);i&&this.redraw(parseInt(i))}__extends(t,e);var i=(__define,t),n=i.prototype;return n.saveFile=function(){var e=egret.localStorage.getItem("dialogIndex");egret.localStorage.setItem("dialogNum"+this.num,e),AtrributeManager.Share().setAtrribute(this.num);var t=new Date,i=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes();egret.localStorage.setItem("saveTime"+this.num,i),this.redraw(parseInt(e))},n.redraw=function(e){var t=DialogManager.Shared().getDialogue(e),i=new eui.Image;i.source=t.scene,i.scaleX=.25,i.scaleY=.25,i.x=0,i.y=0,this.addChild(i);var i=new eui.Image;i.source=t.figure,i.scaleX=.25,i.scaleY=.25,i.bottom=0,i.right=0,this.addChild(i);var n=new eui.Label;n.text=egret.localStorage.getItem("saveTime"+this.num),n.top=5,n.right=5,n.size=20,this.addChild(n)},n.readFile=function(){var e=0,t=egret.localStorage.getItem("dialogNum"+this.num);parseInt(t)>60&&(e=1),null!=t&&(AtrributeManager.Share().getAtrribute(this.num),SceneBlock.Shared().InitScene(parseInt(t)),this.parent.parent.contains(SceneBlock.Shared())||this.parent.parent.addChild(SceneBlock.Shared()),this.parent.parent.removeChild(this.parent))},n.switchToRead=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.saveFile,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readFile,this)},n.switchToSave=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.readFile,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.saveFile,this)},t.index=0,t}(eui.Component);egret.registerClass(GameFile,"GameFile");var GameOver=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/GameOver.exml",this.label=new eui.Label,this.label.x=280,this.label.y=150,this.label.text="游戏结束,进行判定",this.label.textColor=0,this.label.width=750,this.label.height=330,this.label.fontFamily="Tahoma",this.label.size=35,this.label.bold=!0,this.label.italic=!0,this.label.textAlign="center",this.label.verticalAlign="middle",this.addChild(this.label),this.returnGame=new eui.Label,this.returnGame.x=1100,this.returnGame.y=40,this.returnGame.text="返回游戏",this.addChild(this.returnGame),this.returnGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnGAME,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.modifyTabel=function(e){switch(e=e>0?0:Math.abs(e)){case 2:AtrributeManager.Share().getQing()<60&&this.returnScene(294);break;case 3:AtrributeManager.Share().getLiu()<60&&(e=5);break;case 4:AtrributeManager.Share().getSi()<60&&(e=5)}e>1?this.bg.source=EndManage.Shared().getEnding(e).bg:this.bg.source="endbg_png",this.label.text=EndManage.Shared().getEnding(e).content},n.returnGAME=function(){SceneBlock.Shared().InitScene(0),this.parent.addChild(SceneBegin.Shared()),this.parent.removeChild(this)},n.returnScene=function(e){this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this),SceneBlock.Shared().InitScene(e)},t}(eui.Component);egret.registerClass(GameOver,"GameOver");var GameSetting=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/GameSetting.exml",this.btn_agree.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click_agree,this),this.btn_sound.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click_sound,this),this.btn_music.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click_music,this),this.update_buttonstate()}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.click_agree=function(){SoundMenager.Shared().PlayClick(),this.parent.removeChild(this)},n.click_sound=function(){SoundMenager.Shared().PlayClick(),SoundMenager.Shared().IsSound=!SoundMenager.Shared().IsSound,this.update_buttonstate()},n.click_music=function(){SoundMenager.Shared().PlayClick(),SoundMenager.Shared().IsMusic=!SoundMenager.Shared().IsMusic,this.update_buttonstate()},n.update_buttonstate=function(){this.img_music_disable.visible=!SoundMenager.Shared().IsMusic,this.img_sound_disable.visible=!SoundMenager.Shared().IsSound},t}(eui.Component);egret.registerClass(GameSetting,"GameSetting",["eui.UIComponent"]);var Letters=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/Letters.exml",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(){this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnMenu,this),this.mo1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.source="mo_letter1_jpg",this.data.visible=!0},this),this.liu1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.source="liu_letter_jpg",this.data.visible=!0},this),this.si1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.source="zhao_letter_jpg",this.data.visible=!0},this),this.data.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hideLetter,this)},n.hideLetter=function(){SceneBlock.Shared().info.visible=!1,this.data.visible=!1},n.returnMenu=function(){SoundMenager.Shared().PlayClick(),this.parent.removeChild(this)},n.receiveLetter=function(e){switch(e){case"mo1":this.mo1.visible=!0;break;case"liu1":this.liu1.visible=!0;break;case"si1":this.si1.visible=!0}},t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},t}(eui.Component);egret.registerClass(Letters,"Letters");var Menu=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clear,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.onAddToStage=function(){this.save.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toSave,this),this.read.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRead,this),this.attributes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toAtrr,this),this.letter.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toLetter,this)},n.clear=function(){this.parent.removeChild(this)},n.toSave=function(){SoundMenager.Shared().PlayClick(),SaveFile.Shared().switchSave(),this.parent.addChild(SaveFile.Shared())},n.toRead=function(){SoundMenager.Shared().PlayClick(),SaveFile.Shared().switchRead(),this.parent.addChild(SaveFile.Shared())},n.toAtrr=function(){SoundMenager.Shared().PlayClick(),AtrributeManager.Share().redrawLabel(),this.parent.addChild(AtrributeManager.Share())},n.toLetter=function(){SoundMenager.Shared().PlayClick(),this.parent.addChild(Letters.Shared())},t}(eui.Component);egret.registerClass(Menu,"Menu",["eui.UIComponent"]);var SaveFile=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/SaveFile.exml",this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnMenu,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.switchSave=function(){this.file1.switchToSave(),this.file2.switchToSave(),this.file3.switchToSave(),this.file4.switchToSave(),this.title.text="存档"},n.switchRead=function(){this.file1.switchToRead(),this.file2.switchToRead(),this.file3.switchToRead(),this.file4.switchToRead(),this.title.text="读档"},n.returnMenu=function(){this.parent.contains(SceneBlock.Shared())||this.parent.addChild(SceneBlock.Shared()),SoundMenager.Shared().PlayClick(),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(SaveFile,"SaveFile");var SceneBegin=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/SceneBeginSkin.exml",this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_begin,this),this["continue"].addEventListener(egret.TouchEvent.TOUCH_TAP,this.continueGame,this),this.littlegame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.litterGame,this),egret.Tween.removeAllTweens()}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.onclick_begin=function(){SoundMenager.Shared().PlayClick(),this.parent.addChild(new Cartoon),this.parent.removeChild(this)},n.continueGame=function(){SoundMenager.Shared().PlayClick(),SaveFile.Shared().switchRead(),this.parent.addChild(SaveFile.Shared()),this.parent.removeChild(this)},n.litterGame=function(){var e=new fighter.GameContainer;this.parent.addChild(e),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(SceneBegin,"SceneBegin");var SceneBlock=function(e){function t(){e.call(this),this.texturestring=null,this.skinName="resource/eui_skins/SceneBlock.exml",this.touchRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_next,this),this.aside.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidaside,this),this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toMenu,this),this.btn_setting.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_setting,this),this.dialogIndex=0,this.InitScene(0),SoundMenager.Shared().PlayBGM()}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(console.log("创建SceneBlock对象"),t.shared=new t),t.shared},n.onclick_setting=function(){SoundMenager.Shared().PlayClick(),this.addChild(GameSetting.Shared())},n.toMenu=function(){this.addChild(Menu.Shared())},n.InitScene=function(e){console.log("加载"+e+"段对话"),this.dialogbox.init(),this.aside.visible=!1,this.figure.visible=!1,this.dialogbox.visible=!1,this.dialogbox.disselect(),this.dialogIndex=e,this.dialogdata=DialogManager.Shared().getDialogue(e);var t=this.dialogdata.scene;this.isExit(t)&&(this.scene.source=t);var i=this.dialogdata.aside,n=this.dialogdata.texture;this.isExit(n)?(this.texturestring?n!=this.texturestring&&(this.ann.removeTexturn(),this.ann.addTexture(n)):this.ann.addTexture(n),this.texturestring=n):this.texturestring&&(this.ann.removeTexturn(),this.texturestring=null),this.isExit(i)?(this.touchRect.visible=!1,this.aside.visible=!0,this.aside.setAside(i)):(this.touchRect.visible=!0,this.loadingScene())},n.loadingScene=function(){this.dialogbox.visible=!0,this.figure.visible=!0,this.figure.source=this.dialogdata.figure;var e=this.dialogdata.select.length;e?this.dialogbox.setSelection(this.dialogdata):(this.setIndex(0),this.setAdd(),this.dialogbox.setNameText(this.dialogdata.name),this.dialogbox.setDialogText(this.dialogdata.content[0]))},n.onclick_next=function(){SoundMenager.Shared().PlayClick(),this.dialogbox.offselection&&(this.InitScene(this.dialogIndex+1),egret.localStorage.setItem("dialogIndex",this.dialogIndex.toString()))},n.hidaside=function(){SoundMenager.Shared().PlayClick(),this.touchRect.visible=!0,this.aside.visible=!1,this.loadingScene()},n.isExit=function(e){return void 0==e||null==e||0==e.length?!1:!0},n.setIndex=function(e){var t=this.dialogdata.next;if(this.isExit(t)){var i=parseInt(t[e])-1;this.dialogIndex=i,0>i&&(this.parent.addChild(GameOver.Shared()),this.parent.removeChild(this),GameOver.Shared().modifyTabel(i+1))}},n.setAdd=function(){var e=this.dialogdata.add;if(this.isExit(e)){var t=[];t=e[0].split("-"),console.log(e),AtrributeManager.Share().addAtrr(t[0],t[1])}},t}(eui.Component);egret.registerClass(SceneBlock,"SceneBlock");var SoundMenager=function(){function e(){this._click=new egret.Sound,this._click=RES.getRes("buttonclick_mp3"),this._bgm=new egret.Sound,this._bgm=RES.getRes("jiumeng_mp3")}var t=__define,i=e,n=i.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},n.PlayBGM=function(){this.IsMusic&&(this._bgm_channel=this._bgm.play(0,0))},n.StopBGM=function(){null!=this._bgm_channel&&this._bgm_channel.stop()},n.PlayClick=function(){this.IsSound&&this._click.play(0,1)},t(n,"IsMusic",function(){var e=egret.localStorage.getItem("ismusic");return null==e||""==e?!0:"1"==e},function(e){e?(egret.localStorage.setItem("ismusic","1"),this.PlayBGM()):(egret.localStorage.setItem("ismusic","0"),this.StopBGM())}),t(n,"IsSound",function(){var e=egret.localStorage.getItem("isSound");return null==e||""==e?!0:"1"==e},function(e){e?egret.localStorage.setItem("isSound","1"):egret.localStorage.setItem("isSound","0")}),e}();egret.registerClass(SoundMenager,"SoundMenager");var VideoLoading=function(e){function t(){e.call(this),this.video=new egret.Video,this.video.x=0,this.video.y=0,this.video.width=1280,this.video.height=720,this.video.load("resource/asset/particle/startmv2.mp4"),this.addChild(this.video),this.video.once(egret.Event.COMPLETE,this.onLoad,this),this.video.once(egret.IOErrorEvent.IO_ERROR,this.onLoadErr,this),this.video.once(egret.Event.ENDED,this.ended,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onLoad=function(e){var t=new eui.Label;t.text="播放开场动画",t.width=200,t.textColor=16777215,t.x=540,t.y=300,this.addChild(t);var i=new eui.Label;i.text="是",i.textColor=16777215,i.x=540,i.y=340,this.addChild(i);var n=new eui.Label;n.text="否",n.textColor=16777215,n.x=690,n.y=340,this.addChild(n),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlay,this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.end,this)},n.onPlay=function(){var e=new eui.Label;e.text="结束播放>>",e.width=160,e.textColor=16777215,e.x=1100,e.y=20,this.addChildAt(e,2),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.end,this),this.video.play()},n.onLoadErr=function(e){console.log("video load error happened")},n.end=function(e){console.log("停止"),this.video.pause(),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},n.ended=function(e){console.log("停止"),this.video.pause(),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},t}(egret.DisplayObjectContainer);egret.registerClass(VideoLoading,"VideoLoading");var LoadingUI=function(e){function t(){e.call(this),this.h=360,this.w=640,this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){var e=new egret.Shape;e.graphics.beginFill(15920368),e.graphics.drawRect(0,0,1280,720),e.graphics.endFill(),this.addChild(e),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=this.h-50,this.textField.x=this.w-50,this.textField.width=100,this.textField.height=100,this.textField.textColor=8030379,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE,this.textField.textAlign=egret.HorizontalAlign.CENTER;var t=new egret.TextField;this.addChild(t),t.y=18,t.x=32,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.textColor=7307910,t.size=46,t.bold=!0,t.textFlow=[{text:"雨",style:{size:46}},{text:"滴",style:{size:30}},{text:"石",style:{size:50}},{text:"阶",style:{size:36}}],this.createSunMoon(),this.createTween()},n.setProgress=function(e,t){this.addChild(this.getSectorProgress()),this.textField.text=e+"/"+t},n.getSectorProgress=function(){var e=new egret.Shape;return e},n.createSunMoon=function(){this.sun=new egret.Shape,this.sun.graphics.beginFill(15954353),this.sun.graphics.drawCircle(640,720,80),this.sun.graphics.endFill(),this.addChild(this.sun),this.lights=new Array;
for(var e=0;12>e;e++){var t=this.circlexy(640,340,110,30*e),i=new egret.Shape;i.graphics.lineStyle(5,15966410),i.graphics.moveTo(t.x,t.y),t=this.circlexy(640,340,120,30*e),i.graphics.lineTo(t.x,t.y),i.graphics.endFill(),this.lights.push(i),this.addChild(this.lights[e]),this.lights[e].visible=!1}this.moon1=new egret.Shape,this.moon1.graphics.beginFill(6178909),this.moon1.graphics.drawArc(640,830,100,-Math.PI/2,Math.PI/2,!0),this.moon1.graphics.endFill(),this.moon2=new egret.Shape,this.moon2.graphics.beginFill(15920368),this.moon2.graphics.drawArc(700,830,110,-Math.PI/2,Math.PI/2,!0),this.moon2.graphics.endFill(),this.addChild(this.moon1),this.addChild(this.moon2),this.stars=new Array;for(var e=0;12>e;e++){var n=1080*Math.random()+100,s=200*Math.random()+50,r=new egret.Shape;r.graphics.beginFill(9013919),r.graphics.drawCircle(n,s,8),r.graphics.endFill(),this.stars.push(r)}},n.createTween=function(){var e=this;egret.Tween.get(this.sun).to({x:0,y:-380},1e3,egret.Ease.sineOut).call(function(){egret.Tween.get(e.lights[0]).set({visible:!0},300).wait(300).call(function(){egret.Tween.get(e.lights[1]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[2]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[3]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[4]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[5]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[6]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[7]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[8]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[9]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[10]).wait(300).set({visible:!0}).call(function(){egret.Tween.get(e.lights[11]).wait(300).set({visible:!0}).wait(1e3).call(function(){for(var t=0;12>t;t++)e.lights[t].visible=!1;egret.Tween.get(e.sun).to({x:0,y:380},1e3,egret.Ease.sineIn).wait(500).call(function(){for(var t=0;12>t;t++)e.addChild(e.stars[t]);egret.Tween.get(e.moon2).to({x:0,y:-500},1e3,egret.Ease.sineOut),egret.Tween.get(e.moon1).to({x:0,y:-500},1e3,egret.Ease.sineOut).wait(1500).call(function(){egret.Tween.get(e.moon2).to({x:0,y:500},1e3,egret.Ease.sineIn),egret.Tween.get(e.moon1).to({x:0,y:500},1e3,egret.Ease.sineIn).call(function(){for(var t=0;12>t;t++)e.removeChild(e.stars[t]);e.createTween()})})})})})})})})})})})})})})})})},n.circlexy=function(e,t,i,n){var s=new Dot;return s.x=e+Math.sin(2*Math.PI/360*n)*i,s.y=t+Math.cos(2*Math.PI/360*n)*i,s},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Dot=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(Dot,"Dot");var Main=function(e){function t(){e.call(this),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload",9),RES.loadGroup("two",8)},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),this.isResourceLoadEnd=!0,this.createScene()),"two"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this))},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.createGameScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.createGameScene=function(){var e=new SceneBegin;this.addChild(e)},n.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},n.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,n=[],s=0;s<e.length;s++)n.push(i.parser(e[s]));var r=t.textfield,a=-1,h=function(){a++,a>=n.length&&(a=0);var e=n[a];t.changeDescription(r,e);var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(h,t)};h()},n.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var groupname;!function(e){e[e.preload=0]="preload",e[e.two=1]="two"}(groupname||(groupname={}));var ResLoad=function(){function e(){console.log("创建ResLoad")}var t=(__define,e),i=t.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},i.IsExit=function(e){console.log(groupname[e]),RES.isGroupLoaded(groupname[e])?console.log("存在"):console.log("未找到")},e}();egret.registerClass(ResLoad,"ResLoad");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);