var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?s(n):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Aside=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},s.setAside=function(e){this.asidetext.text=e},t}(eui.Component);egret.registerClass(Aside,"Aside");var AtrributeManager=function(e){function t(){e.call(this),this.Num=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],this.skinName="resource/eui_skins/Attribute.exml",this.force=0,this.wit=0,this.popularity=0,this.qing=0,this.si=0,this.liu=0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clear,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Share=function(){return null==t.shared&&(t.shared=new t),t.shared},s.clear=function(){this.parent.removeChild(this)},s.getFoece=function(){return this.force},s.getWit=function(){return this.wit},s.getPopularity=function(){return this.popularity},s.getQing=function(){return this.qing},s.getSi=function(){return this.si},s.getLiu=function(){return this.liu},s.setAtrribute=function(e){var t=this.force+"-"+this.wit+"-"+this.popularity+"-"+this.qing+"-"+this.si+"-"+this.liu;console.log(t),egret.localStorage.setItem("myAtrribute"+e,t)},s.getAtrribute=function(e){var t=[];t=egret.localStorage.getItem("myAtrribute"+e).split("-"),this.force=parseInt(t[0]),this.wit=parseInt(t[1]),this.popularity=parseInt(t[2]),this.qing=parseInt(t[3]),this.si=parseInt(t[4]),this.liu=parseInt(t[5])},s.addAtrr=function(e,t){switch(e=parseInt(e),t=parseInt(t),e){case 1:this.force+=t;break;case 2:this.wit+=t;break;case 3:this.popularity+=t;break;case 4:this.qing+=t;break;case 5:this.si+=t;break;case 6:this.liu+=t}this.toString()},s.toString=function(){this.force+"-"+this.wit+"-"+this.popularity+"-"+this.qing+"-"+this.si+"-"+this.liu},s.redrawLabel=function(){this.qingLabel.text=this.convertNum(this.qing.toString()),this.siLabel.text=this.convertNum(this.si.toString()),this.liuLabel.text=this.convertNum(this.liu.toString()),this.witLabel.text=this.convertNum(this.wit.toString()),this.popLabel.text=this.convertNum(this.popularity.toString()),this.forceLabel.text=this.convertNum(this.force.toString())},s.convertNum=function(e){for(var t="",i=0;i<e.length;i++)t+=this.Num[parseInt(e.charAt(i))];return t},t}(eui.Component);egret.registerClass(AtrributeManager,"AtrributeManager");var Cartoon=function(e){function t(){e.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,function(){this.skip.addEventListener(egret.TouchEvent.TOUCH_TAP,this.forSkip,this)},this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.forSkip=function(){this.skip.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.forSkip,this),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},s.mouseDown=function(e){this.currenty=e.stageY},s.mouseUp=function(e){this.distanceY=e.stageY-this.currenty,this.forNext()},s.forNext=function(){if(this.current.y>-8320){if(this.distanceY<0){var e=egret.Tween.get(this.current);e.to({y:this.current.y-640},1e3,egret.Ease.sineInOut),this.current.y=this.current.y-640}else if(this.distanceY>0){var e=egret.Tween.get(this.current);e.to({y:this.current.y+640},1e3,egret.Ease.sineInOut),this.current.y=this.current.y+640}}else this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(Cartoon,"Cartoon",["eui.UIComponent"]);var Dialog=function(e){function t(){e.call(this),this.offselection=!0}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setNameText=function(e){this.dialogbox.visible=!0,this.person.text=e},s.getNameText=function(){return this.person.text},s.setDialogText=function(e){this.dialog.text=e},s.getDialogText=function(){return this.dialog.text},s.setSelection=function(e){this.offselection=!1,this.dialogbox.visible=!1,this.dialogdata=e;var t=this.dialogdata.select.length;t>0&&(this.select1.visible=!0,this.selection1.text=this.dialogdata.select[0],this.selection1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.s1,this),t>1&&(this.select2.visible=!0,this.selection2.text=this.dialogdata.select[1],this.selection2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.s2,this),t>2&&(this.select3.visible=!0,this.selection3.text=this.dialogdata.select[2],this.selection3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.s3,this))))},s.selected=function(e,t,i,s){this.offselection=!0;var n=[];this.disselect(),this.setNameText(e),this.setDialogText(t),n=i.split("-"),AtrributeManager.Share().addAtrr(n[0],n[1]),void 0!=s&&SceneBlock.Shared().setIndex(s),this.selection1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.s1,this),this.selection2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.s2,this),this.selection3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.s3,this)},s.s1=function(){this.selected(this.dialogdata.name,this.dialogdata.content[0],this.dialogdata.add[0],0)},s.s2=function(){this.selected(this.dialogdata.name,this.dialogdata.content[1],this.dialogdata.add[1],1)},s.s3=function(){this.selected(this.dialogdata.name,this.dialogdata.content[2],this.dialogdata.add[2],2)},s.disselect=function(){this.select3.visible=!1,this.select1.visible=!1,this.select2.visible=!1},t}(eui.Component);egret.registerClass(Dialog,"Dialog");var DialogueData=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(DialogueData,"DialogueData");var DialogManager=function(){function e(){this.items=[],this.items=RES.getRes("dialogue_json")}var t=(__define,e),i=t.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},i.getDialogue=function(e){return 0>e&&(e=0),this.items[e]},e}();egret.registerClass(DialogManager,"DialogManager");var GameFile=function(e){function t(){e.call(this),this.num=t.index,t.index++,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.saveFile,this);var i=egret.localStorage.getItem("dialogNum"+this.num);i&&(console.log(i),this.redraw(parseInt(i)))}__extends(t,e);var i=(__define,t),s=i.prototype;return s.saveFile=function(){var e=egret.localStorage.getItem("dialogIndex");egret.log(e),egret.localStorage.setItem("dialogNum"+this.num,e),AtrributeManager.Share().setAtrribute(this.num);var t=new Date,i=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes();egret.localStorage.setItem("saveTime"+this.num,i),this.redraw(parseInt(e))},s.redraw=function(e){var t=DialogManager.Shared().getDialogue(e),i=new eui.Image;i.source=t.scene,i.scaleX=.25,i.scaleY=.25,i.x=0,i.y=0,this.addChild(i);var i=new eui.Image;i.source=t.figure,i.scaleX=.25,i.scaleY=.25,i.bottom=0,i.right=0,this.addChild(i);var s=new eui.Label;s.text=egret.localStorage.getItem("saveTime"+this.num),s.top=5,s.right=5,s.size=20,this.addChild(s)},s.readFile=function(){var e=egret.localStorage.getItem("dialogNum"+this.num);null!=e&&(AtrributeManager.Share().getAtrribute(this.num),SceneBlock.Shared().InitScene(parseInt(e)),this.parent.parent.removeChild(this.parent))},s.switchToRead=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.saveFile,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readFile,this)},s.switchToSave=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.readFile,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.saveFile,this)},t.index=0,t}(eui.Component);egret.registerClass(GameFile,"GameFile");var GameOver=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/GameOver.exml"}__extends(t,e);var i=(__define,t);i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},t}(eui.Component);egret.registerClass(GameOver,"GameOver");var GameSetting=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/GameSetting.exml",this.btn_agree.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click_agree,this),this.btn_sound.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click_sound,this),this.btn_music.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click_music,this),this.update_buttonstate()}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},s.click_agree=function(){SoundMenager.Shared().PlayClick(),this.parent.removeChild(this)},s.click_sound=function(){SoundMenager.Shared().PlayClick(),SoundMenager.Shared().IsSound=!SoundMenager.Shared().IsSound,this.update_buttonstate()},s.click_music=function(){SoundMenager.Shared().PlayClick(),SoundMenager.Shared().IsMusic=!SoundMenager.Shared().IsMusic,this.update_buttonstate()},s.update_buttonstate=function(){this.img_music_disable.visible=!SoundMenager.Shared().IsMusic,this.img_sound_disable.visible=!SoundMenager.Shared().IsSound},t}(eui.Component);egret.registerClass(GameSetting,"GameSetting",["eui.UIComponent"]);var Menu=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clear,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},s.onAddToStage=function(){this.save.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toSave,this),this.read.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRead,this),this.attributes.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toAtrr,this)},s.clear=function(){this.parent.removeChild(this)},s.toSave=function(){SaveFile.Shared().switchSave(),this.parent.addChild(SaveFile.Shared())},s.toRead=function(){SaveFile.Shared().switchRead(),this.parent.addChild(SaveFile.Shared())},s.toAtrr=function(){AtrributeManager.Share().redrawLabel(),this.parent.addChild(AtrributeManager.Share())},t}(eui.Component);egret.registerClass(Menu,"Menu",["eui.UIComponent"]);var SaveFile=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/SaveFile.exml",this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnMenu,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},s.switchSave=function(){this.file1.switchToSave(),this.file2.switchToSave(),this.file3.switchToSave(),this.file4.switchToSave(),this.title.text="存档"},s.switchRead=function(){this.file1.switchToRead(),this.file2.switchToRead(),this.file3.switchToRead(),this.file4.switchToRead(),this.title.text="读档"},s.returnMenu=function(){this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(SaveFile,"SaveFile");var SceneBegin=function(e){function t(){e.call(this),this.skinName="resource/eui_skins/SceneBeginSkin.exml",this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_begin,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},s.onclick_begin=function(){this.parent.addChild(new Cartoon),this.parent.removeChild(this)},t}(eui.Component);egret.registerClass(SceneBegin,"SceneBegin");var SceneBlock=function(e){function t(){e.call(this),this.isTexture=!1,this.skinName="resource/eui_skins/SceneBlock.exml",this.touchRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_next,this),this.aside.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hidaside,this),this.menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toMenu,this),this.btn_setting.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_setting,this),this.dialogIndex=0,this.InitScene(0),SoundMenager.Shared().PlayBGM()}__extends(t,e);var i=(__define,t),s=i.prototype;return t.Shared=function(){return null==t.shared&&(console.log("创建SceneBlock对象"),t.shared=new t),t.shared},s.onclick_setting=function(){SoundMenager.Shared().PlayClick(),this.addChild(GameSetting.Shared())},s.toMenu=function(){this.addChild(Menu.Shared())},s.InitScene=function(e){this.aside.visible=!1,this.figure.visible=!1,this.dialogbox.visible=!1,this.dialogIndex=e,this.dialogdata=DialogManager.Shared().getDialogue(e);var t=this.dialogdata.scene;this.isExit(t)&&(this.scene.source=t);var i=this.dialogdata.aside;this.isExit(i)?(this.touchRect.visible=!1,this.aside.visible=!0,this.aside.setAside(i)):this.loadingScene();var s=this.dialogdata.texture;this.isTexture?this.isExit(s)||(this.isTexture=!1,this.removeChild(this.system)):this.isExit(s)&&(this.isTexture=!0,this.getTexture(s))},s.loadingScene=function(){this.dialogbox.visible=!0,this.figure.visible=!0,this.figure.source=this.dialogdata.figure;var e=this.dialogdata.select.length;e?this.dialogbox.setSelection(this.dialogdata):(this.dialogbox.setNameText(this.dialogdata.name),this.dialogbox.setDialogText(this.dialogdata.content[0]))},s.getTexture=function(e){var t=RES.getRes(e+"_png"),i=RES.getRes(e+"_json");this.system=new particle.GravityParticleSystem(t,i),this.system.start(),this.addChild(this.system)},s.onclick_next=function(){this.dialogbox.offselection&&(this.InitScene(this.dialogIndex+1),egret.localStorage.setItem("dialogIndex",this.dialogIndex.toString()))},s.hidaside=function(){this.touchRect.visible=!0,this.aside.visible=!1,this.loadingScene()},s.isExit=function(e){return void 0==e||null==e||0==e.length?!1:!0},s.setIndex=function(e){var t=this.dialogdata.next;if(this.isExit(t)){var i=parseInt(t[e])-1;this.dialogIndex=i,0>i&&(this.parent.addChild(new GameOver),this.parent.removeChild(this))}},t}(eui.Component);egret.registerClass(SceneBlock,"SceneBlock");var SoundMenager=function(){function e(){this._click=new egret.Sound,this._click=RES.getRes("buttonclick_mp3"),this._bgm=new egret.Sound,this._bgm=RES.getRes("jiumeng_mp3")}var t=__define,i=e,s=i.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},s.PlayBGM=function(){this.IsMusic&&(this._bgm_channel=this._bgm.play(0,0))},s.StopBGM=function(){null!=this._bgm_channel&&this._bgm_channel.stop()},s.PlayClick=function(){this.IsSound&&this._click.play(0,1)},t(s,"IsMusic",function(){var e=egret.localStorage.getItem("ismusic");return null==e||""==e?!0:"1"==e},function(e){e?(egret.localStorage.setItem("ismusic","1"),this.PlayBGM()):(egret.localStorage.setItem("ismusic","0"),this.StopBGM())}),t(s,"IsSound",function(){var e=egret.localStorage.getItem("isSound");return null==e||""==e?!0:"1"==e},function(e){e?egret.localStorage.setItem("isSound","1"):egret.localStorage.setItem("isSound","0")}),e}();egret.registerClass(SoundMenager,"SoundMenager");var VideoLoading=function(e){function t(){e.call(this),this.video=new egret.Video,this.video.x=0,this.video.y=0,this.video.width=1280,this.video.height=720,this.video.load("resource/asset/particle/startmv2.mp4"),this.addChild(this.video),this.video.once(egret.Event.COMPLETE,this.onLoad,this),this.video.once(egret.IOErrorEvent.IO_ERROR,this.onLoadErr,this),this.video.once(egret.Event.ENDED,this.ended,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onLoad=function(e){var t=new eui.Label;t.text="播放开场动画",t.width=200,t.textColor=16777215,t.x=540,t.y=300,this.addChild(t);var i=new eui.Label;i.text="是",i.textColor=16777215,i.x=540,i.y=340,this.addChild(i);var s=new eui.Label;s.text="否",s.textColor=16777215,s.x=690,s.y=340,this.addChild(s),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlay,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.end,this)},s.onPlay=function(){var e=new eui.Label;e.text="结束播放>>",e.width=160,e.textColor=16777215,e.x=1100,e.y=20,this.addChildAt(e,2),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.end,this),this.video.play()},s.onLoadErr=function(e){console.log("video load error happened")},s.end=function(e){console.log("停止"),this.video.pause(),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},s.ended=function(e){console.log("停止"),this.video.pause(),this.parent.addChild(SceneBlock.Shared()),this.parent.removeChild(this)},t}(egret.DisplayObjectContainer);egret.registerClass(VideoLoading,"VideoLoading");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},s.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},s.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.createGameScene()},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createGameScene=function(){var e=new SceneBegin;this.addChild(e)},s.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},s.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,s=[],n=0;n<e.length;n++)s.push(i.parser(e[n]));var r=t.textfield,a=-1,o=function(){a++,a>=s.length&&(a=0);var e=s[a];t.changeDescription(r,e);var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(o,t)};o()},s.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,s){function n(e){t.call(s,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);